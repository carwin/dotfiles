#+title: Calendar Configuration
#+author: Carwin Young
#+property: header-args:emacs-lisp :mkdirp yes

* General calendar configuration

Provide a top-level =<leader>= key binding for calendar functions: ~C~.

#+begin_src emacs-lisp :noweb-ref cal
(~leader-bind
  "C" '(:ignore t :which-key "calendar"))
#+end_src

Provide =~calendars= so it can be required elsewhere.

#+begin_src emacs-lisp :noweb-ref cal
(provide '~calendars)
#+end_src

#+begin_comment
Interestingly, for reasons that escape me, calling the export
=~calendar= is unacceptable to Emacs and will never load. It's been
pluralized as =~calendars= to get around that. So weird.
#+end_comment

Collect general calendar settings for export.

#+begin_src emacs-lisp :noweb yes :tangle (expand-file-name "~calendars.el" ~eusr-custom-lisp-directory)
;;; ~calendars.el --- Custom features and functions related to calendars -*- lexical-binding: t; -*-

;; Author: Carwin Young <emacs@carw.in>
;; This file is not part of GNU Emacs.
;; This file is free software…

;;; Commentary
;; This file is automatically generated via Org Mode's
;; `org-babel-tangle' feature. The original literate configuration can
;; be found in the source repository's Calendar.org file.

;;; Code:
(message "Loading ~calendar...")
<<cal>>
(message "Loading ~calendar... Done.")
;;; ~calendars.el ends here
#+end_src

* Google Calendar integration

| section package | description                                                        |
|-----------------+--------------------------------------------------------------------|
| [[https://github.com/kidd/org-gcal.el][org-gcal]]        | A package which leverages Google APIs to pull Google Calendar data |

Define the =org-gcal= setup.

#+begin_src emacs-lisp :noweb-ref plus-gcal
(use-package org-gcal
  :straight t
  :init
  (setq org-gcal-client-id (password-store-get "org-gcal/gcal-client-id"))
  (setq org-gcal-client-secret (password-store-get "org-gcal/gcal-client-secret"))
  :custom
  (org-gcal-remove-api-cancelled-events  t)
  (org-gcal-auto-archive nil)
  (org-gcal-update-cancelled-events-with-todo t)
  :config
  (setq org-gcal-fetch-file-alist '(("carwinyoung@gmail.com" .  "~/Notes/Calendar/Personal.org")
																		("carwin.young@snyk.io" . "~/Notes/Calendar/Snyk.org"))))
#+end_src

Provide =<leader>= key bindings related to =org-gcal=.

#+begin_src emacs-lisp :noweb-ref plus-gcal
(~leader-bind
  "Cf" '(org-gcal-fetch :which-key "fetch"))
#+end_src

Set =org-gcal= to update when entering Org's agenda and when finalizing
captured documents. Alternatively, comment out those lines and simply
run ~org-gcal-fetch~ on a timer instead.

#+begin_src emacs-lisp :noweb-ref plus-gcal
;; Run every hour
(run-with-timer 0 (* 30 60) 'org-gcal-fetch)
#+end_src

Provide =+org+gcal= as a package for inclusion elsewhere.

#+begin_src emacs-lisp :noweb-ref plus-gcal
(provide '+org-gcal)
#+end_src

Collect the =org-gcal= blocks and tangle them to =+gcal.el=.

#+begin_src emacs-lisp :noweb yes :tangle (expand-file-name "+org-gcal.el" ~eusr-custom-lisp-directory)
;;; +org-gcal.el --- Custom extensions to the org-gcal package -*- lexical-binding: t; -*-

;; Author: Carwin Young <emacs@carw.in>
;; This file is not part of GNU Emacs.
;; This file is free software…

;;; Commentary
;; This file is automatically generated via Org Mode's
;; `org-babel-tangle' feature. The original literate configuration can
;; be found in the source repository's Calendar.org file.

;;; Code:
(message "Loading +org-gcal...")
<<plus-gcal>>
(message "Loading +org-gcal... Done.")
;;; +org-gcal ends here
#+end_src
